#!/bin/bash

# Install all dependencies
sudo apt update -y

sudo apt install -y build-essential ccache ecj fastjar file g++ gawk \
gettext git java-propose-classpath libelf-dev libncurses5-dev \
libncursesw5-dev libssl-dev python python2.7-dev python3 unzip wget \
python3-distutils python3-setuptools rsync subversion swig time \
xsltproc zlib1g-dev

sudo apt install -y quilt qemu qemu-utils qemu-kvm virt-manager libvirt-daemon-system libvirt-clients bridge-utils busybox curl rsync build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler wget
 
sudo apt-get -y install gcc-multilib g++-multilib 

sudo apt update -y

sudo apt upgrade -y

# Clone the source code from our repository

git clone https://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@github.com/dharun2308/openwrt.git

cd openwrt/openwrt_source_21.02.1/

#./scripts/feeds clean

#./scripts/feeds update -a

#./scripts/feeds install -a

# Test the patches to see if they're applied fine 

make menuconfig -j$(nproc)

make target/linux/{clean,prepare} V=s

make kernel_menuconfig -j$(nproc)

# Finally make the image

./make_image



